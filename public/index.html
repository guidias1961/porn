<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>PORN – Pulse Orion Network</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#ff9900">
<link rel="icon" href="/logo.png" type="image/png">
<link rel="apple-touch-icon" href="/logo.png">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

<script>
(function(){
  const RE = /^https?:\/\/scan\.pulsechain\.com\/api\/v2\/(addresses|tokens)\/(0x[a-fA-F0-9]{40})\/?$/i;
  function toLocal(u){ const m = u && u.match(RE); return m ? `/api/explorer/addresses/${m[2]}` : null; }
  const _fetch = window.fetch.bind(window);
  window.fetch = function(input, init){
    try{
      const url = typeof input === 'string' ? input : input && input.url;
      const local = toLocal(url);
      if(local) return _fetch(local, init);
    }catch(_){}
    return _fetch(input, init);
  };
  const _open = XMLHttpRequest.prototype.open;
  XMLHttpRequest.prototype.open = function(method, url){
    try{ const local = toLocal(url); if(local) arguments[1] = local; }catch(_){}
    return _open.apply(this, arguments);
  };
  const _Request = window.Request;
  window.Request = new Proxy(_Request, {
    construct(target, args){
      try{
        if(args && typeof args[0] === 'string'){
          const local = toLocal(args[0]);
          if(local) args[0] = local;
        }
      }catch(_){}
      return new target(...args);
    }
  });
})();
</script>

<style>
  :root{--bg:#0b0b0c;--panel:#111112;--panel2:#1c1c1e;--text:#e9e9ea;--muted:#a0a0a3;--accent:#ff9900;--accent2:#ff0066;--blue:#1d9bf0}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:#e9e9ea;font-family:'Open Sans',Arial,sans-serif;font-size:14px;line-height:1.45}
  a{color:#5aa9ff;text-decoration:none}
  header{background:#000;border-bottom:2px solid #1a1a1a;color:#fff}
  .topbar{max-width:1280px;margin:0 auto;display:flex;align-items:center;gap:18px;padding:10px 16px}
  .logo{display:flex;align-items:center;gap:10px}
  .logo img{height:30px;width:30px;object-fit:contain}
  .logoText{display:flex;align-items:baseline;gap:6px;font-family:'Bebas Neue',sans-serif;letter-spacing:.5px}
  .logoText .lhs{background:#000;color:#fff;padding:6px 10px;font-size:30px;line-height:1;border:2px solid #fff}
  .logoText .rhs{background:var(--accent);color:#000;padding:6px 10px;font-size:30px;line-height:1;font-weight:900}
  .nav{display:flex;gap:16px;margin-left:8px;flex-wrap:wrap}
  .nav a{color:#ddd;font-weight:700;text-transform:uppercase}
  .nav a:hover{color:#fff}
  .search{margin-left:auto;display:flex;align-items:center;gap:6px}
  .search input{width:460px;max-width:50vw;background:#0f0f0f;border:1px solid #2a2a2a;color:#e9e9ea;padding:8px 10px;outline:none;font-size:14px;border-radius:0}
  .btn{background:#222;border:1px solid #313131;color:#fff;padding:8px 12px;font-weight:700;cursor:pointer;text-transform:uppercase;letter-spacing:.3px;border-radius:0}
  .btn:hover{border-color:#444}
  .btn.accent{background:var(--accent);border-color:var(--accent);color:#000}
  .btn.green{background:#0f8c36;border-color:#0f8c36}
  .btn.twitter{background:var(--blue);border-color:var(--blue)}
  .btn.danger{background:#7a0f0f;border-color:#7a0f0f}
  .subbar{border-top:1px solid #1a1a1a;background:#0a0a0a}
  .subbar .wrap{max-width:1280px;margin:0 auto;padding:8px 16px;display:flex;align-items:center;gap:10px;color:#bbb}
  main{max-width:1280px;margin:0 auto;padding:16px}
  .row{display:flex;gap:16px;align-items:flex-start}
  .panel{background:var(--panel);border:1px solid #222;padding:12px;color:#ddd}
  .hero{flex:1}
  .side{width:360px}
  h1,h2{font-family:'Bebas Neue',sans-serif;margin:0 0 6px;letter-spacing:.3px}
  h1{font-size:34px} h2{font-size:22px}
  .muted{color:var(--muted)}
  .banner{background:#0a0a0a;border:1px dashed #2e2e2e;color:#f7d083;padding:8px 10px}
  .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin-top:12px}
  @media (max-width:1100px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:820px){.grid{grid-template-columns:1fr} .side{display:none}}
  .card{background:var(--panel2);border:1px solid #2a2a2a;padding:8px;position:relative}
  .thumb{background:#070707;border:1px solid #222;height:120px;display:flex;align-items:center;justify-content:center;color:#666;font-weight:700;overflow:hidden}
  .thumb img,.thumb video{width:100%;height:100%;object-fit:cover;display:block}
  .titleLine{margin-top:8px;font-weight:800;color:#fff}
  .meta{display:flex;justify-content:space-between;color:#a8a8ab;font-size:12px;margin-top:4px;gap:12px;flex-wrap:wrap}
  .shareRow{display:flex;gap:6px;margin-top:8px}
  .live{position:absolute;top:8px;left:8px;background:var(--accent2);color:#fff;font-weight:900;padding:2px 6px;font-size:11px}
  footer{padding:20px;color:#999;text-align:center}
  .cols{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .list{background:#0e0e0f;border:1px solid #222;padding:8px}
  .li{display:flex;justify-content:space-between;align-items:center;border-top:1px solid #222;padding:6px 0;gap:8px}
  .li:first-child{border-top:0}
  .li .right{display:flex;gap:6px;align-items:center}
</style>
</head>
<body>
<header>
  <div class="topbar">
    <div class="logo">
      <img src="/logo.png" alt="logo">
      <div class="logoText">
        <div class="lhs">PORN</div><div class="rhs">HUB</div>
      </div>
    </div>
    <nav class="nav">
      <a href="#" onclick="return false">TRENDING</a>
      <a href="#" onclick="return false">LIVE</a>
      <a href="#" onclick="return false">WALLETS</a>
      <a href="#" onclick="return false">EXPOSED</a>
    </nav>
    <div class="search">
      <input id="addrInput" placeholder="Drop a 0x and get undressed">
      <button class="btn accent" id="analyzeBtn">Analyze</button>
      <button class="btn green" id="buyBtn">buy</button>
      <button class="btn danger" id="closeBtn">X</button>
    </div>
  </div>
  <div class="subbar">
    <div class="wrap" style="gap:14px;flex-wrap:wrap">
      <span id="apiStatus" class="muted">ready to peep</span>
      <span style="margin-left:auto" class="muted">Pulse Orion Network</span>
    </div>
  </div>
</header>

<main>
  <div class="row">
    <section class="panel hero">
      <h1>Live wallets exposed</h1>
      <div class="banner" id="hint">Paste a 0x. We peep. You weep. Rankings update as the crowd watches.</div>
      <div id="grid" class="grid"></div>

      <h2 style="margin-top:16px">Trending</h2>
      <div class="cols">
        <div class="list">
          <div style="font-weight:800;margin-bottom:6px">Wallets most watched</div>
          <div id="trendWallets"></div>
        </div>
        <div class="list">
          <div style="font-weight:800;margin-bottom:6px">Tokens most ogled</div>
          <div id="trendTokens"></div>
        </div>
      </div>
    </section>

    <aside class="panel side">
      <h2>What is this</h2>
      <p class="muted">On-chain peep show for degenerates with taste.</p>
      <p class="muted">Expose your 0x or bring a token to the stage.</p>
      <p class="muted">If it moves, we rate it. If it dumps, we laugh.</p>
      <hr style="border:0;border-top:1px solid #222;margin:12px 0">
      <button class="btn twitter" id="tweetSite">Tweet the site</button>
    </aside>
  </div>
</main>

<footer>© PORN • Pulse Orion Network • entertainment only</footer>

<script>
if ('serviceWorker' in navigator) { navigator.serviceWorker.register('/sw.js').catch(()=>{}); }

let WPLS_USD = 0.00002;
(async function loadPrice(){ try{ const r = await fetch("/api/price"); if(r.ok){ const j = await r.json(); if(j && j.wplsUsd && Number(j.wplsUsd)>0) WPLS_USD = Number(j.wplsUsd); } }catch{} })();

const MAX_CARDS = 24;
const PULSEX_BUY_URL = "https://app.pulsex.com/";

const addrInput   = document.getElementById('addrInput');
const analyzeBtn  = document.getElementById('analyzeBtn');
const grid        = document.getElementById('grid');
const apiStatus   = document.getElementById('apiStatus');
const trendWallets= document.getElementById('trendWallets');
const trendTokens = document.getElementById('trendTokens');

document.getElementById('buyBtn').onclick   = ()=> window.open(PULSEX_BUY_URL,"_blank");
document.getElementById('closeBtn').onclick = ()=>{ addrInput.value = ""; grid.innerHTML = ""; };

const shortAddr = a => a ? (a.slice(0,6)+"..."+a.slice(-4)) : "unknown";
function toFloat(x){ if(x==null) return 0; const n=Number(x); if(!isFinite(n)) return 0; return n>1e12 ? n/1e18 : n; }
function fmtUsd(x){ if(x==null || !isFinite(x)) return ""; return "$"+Number(x).toLocaleString(undefined,{maximumFractionDigits:2}); }

function eroticMessage(ctx){
  const { type, usd, txs, holders, verified, reputation, name, symbol } = ctx;
  const usdStr = "$"+usd.toLocaleString(undefined,{maximumFractionDigits:2});
  if(type==='wallet'){
    const tier = usd>100000 ? "whale" : usd>10000 ? "alpha" : usd>1000 ? "tease" : usd>100 ? "soft" : "bare";
    const act  = txs>500 ? "experienced" : txs>100 ? "regular" : "shy";
    const mood = usd<10 ? "broke and brazen" : usd>5000 ? "loaded and shameless" : "curious and reckless";
    return `This wallet goes ${tier}. ${usdStr} out in the open. ${act} vibes. ${mood} energy.`;
  }
  const nm = [symbol, name].filter(Boolean).join(" ");
  const crowd = holders>50000 ? "crowd goes feral" : holders>5000 ? "room gets loud" : holders>500 ? "intimate claps" : "private booth";
  const badge = verified ? "verified star" : "masked newcomer";
  const rep   = reputation && reputation!=="ok" ? `dirty rep` : "clean lights";
  return `${nm} on stage. ${badge} status. ${crowd}. ${rep}. Who is buying the next dance.`;
}

function titleFor({address, usd, type, name, symbol}){
  if(type==='token'){
    const nm = [symbol, name].filter(Boolean).join(" ");
    return `${nm || 'TOKEN'} is on stage. Watch closely.`;
  }
  return `${shortAddr(address)} is showing it all. $${usd.toLocaleString(undefined,{maximumFractionDigits:2})} waving at the glass.`;
}

function pickMedia({ type, usd, market }){
  if(type === 'token'){
    const mc = Number(market?.market_cap_usd || 0);
    if (mc > 1_000_000) return { kind: 'video', src: '/2.mp4' };
    if (mc > 100_000)  return { kind: 'video', src: '/1.mp4' };
    if (mc > 0 && mc < 100_000) return { kind: 'image', src: '/3.png' };
    return null;
  } else {
    if (usd > 100_000) return { kind: 'video', src: '/3.mp4' };
    if (usd > 100)     return { kind: 'image', src: '/1.png' };
    return { kind: 'image', src: '/2.png' };
  }
}

function addCard({address, usd, balance, symbol, name, message, icon, type, holders, market}){
  const card = document.createElement('div');
  card.className = 'card';

  let right = "";
  if(type==='token'){
    const parts = [];
    if(market?.price_usd) parts.push(`Price ${fmtUsd(market.price_usd)}`);
    if(market?.market_cap_usd) parts.push(`MC ${fmtUsd(market.market_cap_usd)}`);
    if(market?.liquidity_usd) parts.push(`Liq ${fmtUsd(market.liquidity_usd)}`);
    if(holders && holders>0) parts.push(`Holders ${holders.toLocaleString()}`);
    right = parts.join(" • ");
  }else{
    right = `Bal ${balance.toLocaleString(undefined,{maximumFractionDigits:4})} WPLS • ${fmtUsd(usd)}`;
  }

  const headline = type==='token'
    ? `${[symbol, name].filter(Boolean).join(" ") || 'TOKEN'}`
    : `${shortAddr(address)}`;

  const media = pickMedia({ type, usd, market });
  let thumbHTML = "";
  if (media){
    if (media.kind === 'video'){ thumbHTML = `<video src="${media.src}" muted playsinline autoplay loop></video>`; }
    else { thumbHTML = `<img src="${media.src}" alt="">`; }
  } else if (icon && type==='token'){
    thumbHTML = `<img src="${icon}" alt="token">`;
  } else {
    thumbHTML = (type==='token'?'TOKEN':'WALLET');
  }

  const pairLink = market?.pair_url ? `<a class="btn" target="_blank" href="${market.pair_url}">Pair</a>` : "";

  card.innerHTML = `
    <div class="live">LIVE</div>
    <div class="thumb">${thumbHTML}</div>
    <div class="titleLine">${headline}</div>
    <div class="meta"><span>${type}</span><span>${right}</span></div>
    <div class="banner" style="margin-top:8px">${message}</div>
    <div class="shareRow">
      <button class="btn twitter">Share</button>
      ${pairLink}
      <a class="btn" target="_blank" href="https://scan.pulsechain.com/address/${address}">Explorer</a>
    </div>`;
  card.querySelector('.btn.twitter').onclick = ()=>{
    const text = titleFor({ address, usd, type, name, symbol }) + " " + message + " #PulseChain #WPLS #PulseOrionNetwork";
    const u = location.origin + location.pathname + "?addr=" + address;
    window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(text)+"&url="+encodeURIComponent(u),'_blank');
  };
  grid.appendChild(card);
  while(grid.children.length>MAX_CARDS) grid.removeChild(grid.firstChild);
}

async function analyze(addr){
  const url = `/api/explorer/addresses/${addr}`;
  try{
    apiStatus.textContent = "peeking";
    const r = await fetch(url, { headers:{ accept:'application/json' } });
    if(!r.ok){ apiStatus.textContent = "API " + r.status; return; }
    const data = await r.json();
    const item = Array.isArray(data.items) ? (data.items[0]||{}) : data;

    const serverKind = data.kind || (item.is_token ? "token" : (item.is_contract ? "wallet" : "wallet"));
    const isToken = serverKind === "token";
    const token = item.token || {};
    const tName = token.name || null;
    const tSym  = token.symbol || (isToken ? 'TOKEN' : 'WPLS');
    const txs = Number(item.transactions_count||0);
    const holders = Number(token.holders_count||0) || null;
    const verified = !!item.is_verified;
    const reputation = item.reputation || token.reputation || null;
    const market = token.market || null;

    const balWPLS = toFloat(item.coin_balance);
    const usd = isToken ? 0 : balWPLS * WPLS_USD;

    const type = isToken ? "token" : "wallet";
    const message = eroticMessage({ type, usd, txs, holders: holders||0, verified, reputation, name: tName, symbol: tSym });
    const titleLine = titleFor({ address: addr, usd, type, name: tName, symbol: tSym });

    addCard({ address: addr, usd, balance: balWPLS, symbol: tSym, name: tName, message, icon: token.icon_url, type, holders, market });

    await fetch("/api/record", {
      method:"POST", headers:{'content-type':'application/json'},
      body: JSON.stringify({ address: addr, type, symbol: tSym, name: tName, usd, balance: balWPLS, titleLine, message, icon: token.icon_url, holders, market })
    });

    loadTrending();
    apiStatus.textContent = "done";
  }catch(e){
    apiStatus.textContent = e.message || "error";
  }
}

async function loadTrending(){
  try{
    const r = await fetch("/api/trending?limit=10");
    const j = await r.json();
    renderList(trendWallets, j.wallets);
    renderList(trendTokens,  j.tokens);
  }catch{
    trendWallets.innerHTML = `<div class="muted">no data</div>`;
    trendTokens.innerHTML  = `<div class="muted">no data</div>`;
  }
}
async function loadFeed(){
  try{
    const r = await fetch("/api/feed?limit=24");
    if(!r.ok) return;
    const j = await r.json();
    grid.innerHTML = "";
    (j.items || []).forEach(it=>{
      addCard({
        address: it.address,
        usd: it.usd || 0,
        balance: it.balance || 0,
        symbol: it.symbol || null,
        name: it.name || null,
        message: it.message || "",
        icon: it.icon || null,
        type: it.type,
        holders: it.holders || null,
        market: it.market || null
      });
    });
  }catch{}
}

function renderList(el, arr){
  if(!arr || !arr.length){ el.innerHTML = `<div class="muted">no data</div>`; return; }
  el.innerHTML = arr.map(it=>{
    const url = it.type === 'token'
      ? `https://scan.pulsechain.com/token/${it.address}`
      : `https://scan.pulsechain.com/address/${it.address}`;
    return `
      <div class="li">
        <span>${shortAddr(it.address)} <span class="muted">(${it.type}${it.symbol?": "+it.symbol:""})</span></span>
        <span class="right">
          <span>x${it.count}</span>
          <a class="btn" target="_blank" href="${url}">Explorer</a>
        </span>
      </div>`;
  }).join("");
}

document.getElementById('analyzeBtn').onclick = ()=>{
  const a = addrInput.value.trim();
  if(!/^0x[a-fA-F0-9]{40}$/.test(a)){ alert('Paste a valid 0x address'); return; }
  analyze(a);
};
addrInput.addEventListener('keydown',(e)=>{ if(e.key==='Enter') document.getElementById('analyzeBtn').click(); });
document.getElementById('tweetSite').onclick = ()=>{
  const text = "Peeping wallets at PORN. Bring your 0x. #PulseChain #WPLS #PulseOrionNetwork";
  window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(text)+"&url="+encodeURIComponent(location.href),'_blank');
};

loadFeed();
loadTrending();
</script>
</body>
</html>

